#include <stdio.h>
#include "lcd.h"
#include "delay.h"
#include "gui.h"
#include "test.h"
#include "touch.h"
#include "key.h" 
#include "led.h"
#include "myfuns.h"
#include "MMC_SD.h" 

u8 banhui[] = 
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x3F,0xE0,0x7F,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0xE0,0x7F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xFF,0xE0,0x7F,0xFF,0x80,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0xE0,0x7F,
0xFF,0xF0,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xE0,0x7F,0xFF,0xFC,0x00,0x00,0x00,0x00,0x03,0xFF,0xFF,0xE0,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x07,0xFF,0xFF,0xE0,0x7F,0xFF,0xFF,0x80,
0x00,0x00,0x00,0x1F,0xFF,0xF0,0x00,0x7F,0x7F,0xFF,0xC0,0x00,0x00,0x00,0x3F,0xFE,0x00,0x00,0x7F,0x03,0xFF,0xE0,0x00,0x00,0x00,0x7F,0xF0,0x00,0x00,0x7F,0x00,0xFF,0xF0,0x00,0x00,0x00,
0xFF,0xE0,0x00,0x00,0x7F,0x00,0x3F,0xF8,0x00,0x00,0x00,0xFF,0xC0,0x00,0x00,0x7F,0x00,0x0F,0xFC,0x00,0x00,0x01,0xFF,0x00,0x00,0x00,0x7F,0x00,0x07,0xFE,0x00,0x00,0x03,0xFE,0x00,0x00,
0x00,0x7F,0x00,0x03,0xFF,0x00,0x00,0x03,0xFC,0x00,0x00,0x00,0x7F,0x00,0x01,0xFF,0x00,0x00,0x07,0xF8,0x00,0x00,0x00,0x7F,0x00,0x00,0xFF,0x80,0x00,0x0F,0xF0,0x00,0x00,0x00,0x7F,0x00,
0x00,0x7F,0x80,0x00,0x1F,0xF0,0x00,0x00,0x00,0x7F,0x00,0x00,0x3F,0xC0,0x00,0x1F,0xE0,0x00,0x00,0x00,0x7F,0x00,0x00,0x3F,0xC0,0x00,0x3F,0xC0,0x00,0xFC,0x00,0x7F,0x00,0x00,0x1F,0xE0,
0x00,0x3F,0x80,0x00,0xFC,0x00,0x7F,0x00,0x00,0x0F,0xE0,0x00,0x3F,0x80,0x00,0xFC,0x00,0x7F,0x00,0x00,0x0F,0xF0,0x00,0x7F,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x07,0xF0,0x00,0x7F,0x00,
0x00,0xFC,0x00,0x7F,0x00,0x00,0x07,0xF0,0x00,0x7E,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0xFC,0x00,
0x7F,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0xFC,0x07,0xF0,0xFC,0x00,0x7F,0x00,0x1F,0xFF,0xFF,0xFC,0xFC,0x07,0xF0,0xFC,0x00,0xFF,0x00,0x1F,
0xFF,0xFF,0xFC,0xFC,0x07,0xF0,0xFC,0x01,0xFE,0x00,0x1F,0xFF,0xFF,0xFC,0xFC,0x07,0xF0,0xFC,0x03,0xFC,0x00,0x1F,0xFF,0xFF,0xFC,0xFC,0x07,0xF0,0xFC,0x07,0xFC,0x00,0x1F,0xFF,0xFF,0xFC,
0xFF,0xFF,0xF0,0xFC,0x07,0xF8,0x00,0x1F,0xFF,0xFF,0xFC,0xFF,0xFF,0xF0,0xFC,0x0F,0xF0,0x00,0x1F,0xFF,0xFF,0xFC,0xFF,0xFF,0xF0,0xFC,0x0F,0xE0,0x00,0x00,0x1F,0xFE,0x00,0xFF,0xFF,0xF0,
0xFC,0x1F,0xC0,0x00,0x00,0x3F,0xFE,0x00,0xFF,0xFF,0xF0,0xFC,0x1F,0xC0,0x00,0x00,0x7F,0xFF,0x00,0xFF,0xFF,0xF0,0xFC,0x3F,0xC0,0x00,0x00,0xFF,0xFF,0x80,0xFF,0xFF,0xF0,0xFC,0x3F,0xDC,
0x00,0x01,0xFE,0x3F,0xC0,0x00,0x07,0xF0,0xFC,0x3F,0xFC,0x00,0x03,0xFC,0x1F,0xE0,0x00,0x07,0xF0,0xFC,0x3F,0xFC,0x00,0x07,0xF8,0x0F,0xF0,0x00,0x07,0xF0,0xFC,0x1F,0xFE,0x00,0x0F,0xF0,
0x07,0xF8,0x00,0x07,0xF0,0xFC,0x1F,0xFE,0x00,0x1F,0xE0,0x03,0xFC,0x00,0x07,0xF0,0xFC,0x0F,0xFE,0x00,0x3F,0xC0,0x01,0xFE,0x00,0x00,0x00,0xFC,0x07,0xFF,0x00,0x3F,0xC0,0x00,0xFE,0x00,
0x00,0x00,0xFC,0x03,0xFF,0x00,0x7F,0x80,0x00,0xFE,0xFC,0x00,0x00,0xFC,0x07,0xFF,0x80,0x7F,0xC0,0x01,0xFE,0xFC,0x00,0x00,0xFC,0x07,0xFF,0x80,0x7F,0xFF,0xFF,0xFE,0xFC,0x00,0x00,0xFC,
0x01,0xFF,0xC0,0x7F,0xFF,0xFF,0xFE,0xFC,0x00,0x00,0xFC,0x00,0x03,0xC0,0x3F,0xFF,0xFF,0xFE,0xFC,0x00,0x00,0xFC,0x00,0x00,0x00,0x3F,0xFF,0xFF,0xFE,0xFC,0x00,0x00,0xFC,0x00,0x7F,0x00,
0x1F,0xFF,0xFF,0xFC,0xFC,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x07,0xF8,0x00,0xFE,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x03,0xF8,0x00,0xFE,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x07,0xF0,
0x00,0xFE,0x00,0x00,0xFC,0x00,0x7F,0x00,0x00,0x07,0xF0,0x00,0x7F,0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x07,0xF0,0x00,0x7F,0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x0F,0xF0,0x00,0x7F,0x00,
0x00,0x00,0x00,0x7F,0x00,0x00,0x0F,0xE0,0x00,0x3F,0x80,0x00,0x00,0x00,0x7F,0x00,0x00,0x1F,0xE0,0x00,0x3F,0x80,0x00,0x00,0x00,0x7F,0x00,0x00,0x1F,0xC0,0x00,0x3F,0xC0,0x00,0x00,0x00,
0x7F,0x00,0x00,0x3F,0xC0,0x00,0x1F,0xE0,0x00,0x00,0x00,0x7F,0x00,0x00,0x3F,0x80,0x00,0x1F,0xF0,0x00,0x00,0x00,0x7F,0x00,0x00,0x7F,0x80,0x00,0x0F,0xF0,0x00,0x00,0x00,0x7F,0x00,0x00,
0xFF,0x00,0x00,0x07,0xF8,0x00,0x00,0x00,0x7F,0x00,0x01,0xFF,0x00,0x00,0x07,0xFC,0x00,0x00,0x00,0x7F,0x00,0x01,0xFE,0x00,0x00,0x03,0xFE,0x00,0x00,0x00,0x7F,0x00,0x03,0xFE,0x00,0x00,
0x01,0xFF,0x00,0x00,0x00,0x7F,0x00,0x07,0xFC,0x00,0x00,0x01,0xFF,0xC0,0x00,0x00,0x7F,0x00,0x1F,0xF8,0x00,0x00,0x00,0xFF,0xE0,0x00,0x00,0x7F,0x00,0x3F,0xF0,0x00,0x00,0x00,0x7F,0xF0,
0x00,0x00,0x7F,0x00,0xFF,0xF0,0x00,0x00,0x00,0x3F,0xFE,0x00,0x00,0x7F,0x03,0xFF,0xE0,0x00,0x00,0x00,0x1F,0xFF,0xC0,0x00,0x7F,0x0F,0xFF,0xC0,0x00,0x00,0x00,0x07,0xFF,0xFF,0xFF,0xFF,
0x0F,0xFF,0x00,0x00,0x00,0x00,0x03,0xFF,0xFF,0xFF,0xFF,0x0F,0xFE,0x00,0x00,0x00,0x00,0x01,0xFF,0xFF,0xFF,0xFF,0x0F,0xFC,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFF,0x0F,0xF0,0x00,
0x00,0x00,0x00,0x00,0x1F,0xFF,0xFF,0xFF,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0xFF,0xFF,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

u8 dian[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,
0x00,0x0F,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x1F,0x00,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x1F,0xFF,0x00,0x00,0x00,0x7F,0xFF,0xE0,0x00,0x0F,
0xFF,0x03,0xE0,0x00,0x3F,0x1F,0x03,0xC0,0x00,0x3E,0x1F,0xE3,0xC0,0x00,0x3C,0x7F,0xE3,0xC0,0x00,0x3C,0xFF,0xE3,0xC0,0x00,0x1C,0xFF,0x83,0x80,0x00,0x1C,0x7E,0x07,0x80,0x00,0x1E,0x3E,
0x07,0x80,0x00,0x0E,0x3F,0xE7,0x00,0x00,0x07,0xFF,0xEF,0x00,0x00,0x07,0xFF,0xFE,0x00,0x00,0x03,0xFE,0x3E,0x00,0x00,0x01,0xDE,0x00,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x00,0x0E,0x00,
0x01,0x00,0x00,0x07,0x00,0x03,0x00,0x00,0x07,0x80,0x1F,0x00,0x00,0x01,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x7F,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

u8 qi[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x00,0x00,0x00,0x00,0x3E,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x00,
0x00,0x78,0x0F,0x00,0x00,0x00,0xF0,0xFF,0x00,0x00,0x01,0xFF,0xFC,0x00,0x00,0x03,0xFF,0xF0,0x00,0x00,0x07,0x9F,0x00,0x00,0x00,0x0F,0x08,0x18,0x00,0x00,0x1C,0x01,0xF8,0x00,0x00,0x38,
0x0F,0xF8,0x00,0x00,0x00,0xFF,0xC0,0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x01,0xFF,0x00,0x00,0x00,0x1F,0xFE,0x00,0x00,0x00,0xFF,0xFC,0x00,0x00,0x0F,0xFC,
0x78,0x00,0x00,0xFF,0xE0,0x78,0x00,0x00,0xFE,0x00,0x70,0x02,0x00,0x70,0x00,0xF0,0x03,0x00,0x00,0x00,0xF0,0x01,0x00,0x00,0x00,0xE0,0x01,0x00,0x00,0x00,0xE0,0x01,0x00,0x00,0x00,0xE0,
0x03,0x00,0x00,0x00,0xE0,0x03,0x00,0x00,0x00,0xE0,0x03,0x00,0x00,0x00,0x70,0x03,0x00,0x00,0x00,0x3C,0x07,0x00,0x00,0x00,0x1F,0xFF,0x00,0x00,0x00,0x07,0xFF,0x00,0x00,0x00,0x00,0xFF,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

u8 yi[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xF8,0x00,0x00,0x3F,0xFF,0xFC,0x04,0x3F,0xFF,0xFF,0xFE,0x07,0xFF,0xFF,0xFF,0xFF,0x07,0xFF,0xFF,
0x00,0x3F,0x03,0xC0,0x00,0x00,0x07,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

u8 ban[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0xF0,0xC0,0x00,0x00,0x3F,0xF0,0xC0,0x7C,0x00,0x1F,0xE0,0xFF,0xFC,0x00,0x1F,0x80,0xFF,0xF8,0x00,0x00,
0x08,0xDF,0xE0,0x00,0x00,0x1C,0xC7,0xE0,0x00,0x00,0x0F,0xC1,0xE0,0x00,0x07,0x0F,0xC1,0xE0,0x00,0x0F,0xC5,0xC3,0xFE,0x00,0x7F,0x81,0x8F,0xFC,0x03,0xFF,0x01,0x9F,0xF0,0x01,0xFE,0x03,
0x1F,0xE0,0x01,0x8E,0x03,0x03,0xC0,0x00,0x0F,0xC6,0x03,0xC0,0x00,0x0F,0x86,0x03,0xC0,0x00,0x0F,0x0E,0x03,0xC0,0x00,0x1F,0x1E,0x03,0xC0,0x00,0x3E,0x1E,0x03,0xE0,0x00,0x7C,0x3C,0x1F,
0xFF,0x00,0xF8,0xFF,0xFF,0xFF,0x00,0xF1,0xF3,0xFF,0xFF,0x00,0x03,0xE0,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

u8 SD_Out_Buf[512]={0xF0};
u16 PenColorFml[] = {WHITE,BLACK,BLUE,BRED,GRED,GBLUE,RED,MAGENTA,GREEN,CYAN,YELLOW,BROWN,BRRED};
u16 BgdColorFml[] = {BLACK,WHITE};

//每个界面下有效点击区域的坐标表(xmin,ymin,xmax,ymax)
u16 Go2ClassIntr[4]={60,50,145,105}; //班级介绍
u16 Go2MembrIntr[4]={175,50,260,105}; //成员介绍
u16 Go2FilmStrip[4]={60,135,145,190}; //幻灯片
u16 Go2HandWrite[4]={175,135,260,190}; //手写屏
u16 Go2Calbrtion[4]={270,0,319,30}; //校准
u16 Back2Home[4]={0,0,50,30}; //回到主页面
u16 ShowTools[4]={5,5,30,35};//显示工具栏
u16 LeaveHW[4]={20,16,80,56};//画板界面的返回键
u16 Clear[4]={20,72,80,112};//清除画板
u16 PColor[4]={20,128,80,168};//画笔颜色
u16 BColor[4]={20,184,80,224};//背景颜色
u16 Devlp[4]={90,40,230,80};//成长从不设限
u16 Prctc[4]={90,100,230,140};//服务没有重点
u16 Entrt[4]={90,160,230,200};//青春洋溢笑脸
/*-------------------------------------
  name: SysState
  func:指示当前界面状态
    0: 主界面
    1: 班级介绍
    2: 成员介绍
    3: 幻灯片
    4: 手写屏
	5: 校准
--------------------------------------*/
u8 SysState=0;

/*-------------------------------------
	name: System
	func: 主系统，放到while(1)里
--------------------------------------*/
void System(void)
{ 
	switch(SysState)
	{
		case 0:
		{
			HomePage();break;
		}
		case 1:
		{
			ClassIntr();break;
		}
		case 2:
		{
			MembIntr();break;
		}
		case 3:
		{
			FilmStrip();break;
		}
		case 4:
		{
			HandWrite();break;
		}
		case 5:
		{
			Calibration();break;
		}
		default: break;
	}

}


/*-------------------------------------
	name: HomePage
	func: 主界面运行函数
--------------------------------------*/
void HomePage(void)
{
	DrawHomePage();
	TP_Prepare();
	while(SysState == 0)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			if(Touch_Inside_Box(&tp_dev,Go2ClassIntr)) SysState = 1;
			else if(Touch_Inside_Box(&tp_dev,Go2MembrIntr)) SysState = 2;
			else if(Touch_Inside_Box(&tp_dev,Go2FilmStrip)) SysState = 3;
			else if(Touch_Inside_Box(&tp_dev,Go2HandWrite)) SysState = 4;
			else if(Touch_Inside_Box(&tp_dev,Go2Calbrtion)) SysState = 5;
		}
	}
}


/*-------------------------------------
	name: ClassIntr
	func: 班级介绍界面运行函数
--------------------------------------*/
void ClassIntr(void)
{	
	u16 i;
	LeaveHP();
	LCD_Clear(BLACK);
	LCD_Show_SD_Full_Img(50000);

	TP_Prepare();
	while(1)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			break;
		}
	}

	LCD_Clear(BLACK);
	ShowSquare(banhui,88,RED,BLACK,205,76);delay_ms(200);
	ShowSquare(dian,40,RED,BLACK,27-4,80);delay_ms(200);
	ShowSquare(qi,40,RED,BLACK,70-4,80);delay_ms(200);
	ShowSquare(yi,40,RED,BLACK,113-4,80);delay_ms(200);
	ShowSquare(ban,40,RED,BLACK,156-4,80);delay_ms(200);
	Show_Str(32-4,135, YELLOW, BLACK, "信",16,0);delay_ms(50);
	Show_Str(32+20-4,135, YELLOW, BLACK, "言",16,0);delay_ms(50);
	Show_Str(32+40-4,135, YELLOW, BLACK, "笃",16,0);delay_ms(50);
	Show_Str(32+60-4,135, YELLOW, BLACK, "行",16,0);delay_ms(50);
	Show_Str(183-60-4,135, YELLOW, BLACK, "博",16,0);delay_ms(50);
	Show_Str(183-40-4,135, YELLOW, BLACK, "学",16,0);delay_ms(50);
	Show_Str(183-20-4,135, YELLOW, BLACK, "精",16,0);delay_ms(50);
	Show_Str(183-4,135, YELLOW, BLACK, "思",16,0);
	POINT_COLOR=YELLOW;
	for(i=32-4; i<199-4; i++)
	{
		LCD_DrawLine(i,124,i,125);
		delay_ms(1);
	}

	TP_Prepare();
	while(1)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			break;
		}
	}

	LCD_Fill(0,0,204,239,BLACK);
	Appr();
	Show_Str(9,40, BLACK, YELLOW, "班级共有成员28人",16,0);
	Show_Str(9,40+72, BLACK, GREEN, "保送研究生7人",16,0);
	Show_Str(9,40+144, BLACK, GBLUE, "华为就业1人",16,0);

	TP_Prepare();
	while(1)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			break;
		}
	}

	Disappr();
	Appr();
	Show_Str(9,40, BLACK, YELLOW, "100%学生干部经历",16,0);
	Show_Str(9,40+72, BLACK, GREEN, "100%社会实践经历",16,0);
	Show_Str(9,40+144, BLACK, GBLUE, "100%科研经历",16,0);

	TP_Prepare();
	while(1)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			break;
		}
	}

	Disappr();
	Appr();
	Show_Str(9,40, BLACK, YELLOW, "共产党员12人",16,0);
	Show_Str(9,40+72, BLACK, GREEN, "积极分子10人",16,0);
	Show_Str(9,40+144, BLACK, GBLUE, "部长6人",16,0);

	TP_Prepare();
	while(1)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			break;
		}
	}

	Disappr();
	Appr();
	Show_Str(9,40, BLACK, YELLOW, "人均1个国家级奖励",16,0);
	Show_Str(9,40+72, BLACK, GREEN, "162次省校级奖励",16,0);
	Show_Str(9,40+144, BLACK, GBLUE, "5篇论文",16,0);
	Draw_Box(Go2Calbrtion,DARKBLUE);
	Show_Str(279, 7, WHITE, DARKBLUE, "返回",16,0);

	TP_Prepare();
	while(SysState == 1)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			if(Touch_Inside_Box(&tp_dev,Go2Calbrtion)) 
			{	
				SysState = 0;
				Disappr();
				ReturnHP();
			}
		}
	}
}


/*-------------------------------------
	name: MembIntr
	func: 成员介绍界面运行函数
--------------------------------------*/
void MembIntr(void)
{	
	u8 memb_idx=0; //指示当前在显示第几个人的自我介绍
	u32 i=2000000; //延时
	u8 flag1 = 0; //指示已经手动完成图片切换
	LeaveHP();
	
	while(SysState == 2)
	{	
		LCD_Clear(BLACK);
		POINT_COLOR = WHITE;
		LCD_DrawRectangle(0, 0, 319, 239);
		Show_Memb_Info(memb_idx);
		LCD_Show_SD_Small_Img(100*memb_idx);
		Draw_Box(Back2Home,DARKBLUE);
		Show_Str(9,7, WHITE, DARKBLUE, "返回",16,0);

		i = 2000000;
		// while(i--)
		while(1)
		{	
			TP_Prepare();
			tp_dev.scan(0); 
			if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
			{	
				if(Touch_Inside_Box(&tp_dev,Back2Home))
				{
					SysState = 0;
					ReturnHP();
					break;
				}
				else if((tp_dev.x < 160)&&(tp_dev.x > 0))
				{	
					flag1 = 1;
					if(memb_idx == 0) memb_idx = 27;
					else memb_idx--;
					break;
				}
				else if((tp_dev.x >= 160)&&(tp_dev.x < 320))
				{
					flag1 = 1;
					if(memb_idx == 27) memb_idx = 0;
					else memb_idx++;
					break;
				}
			}
		}

		if(!flag1)
		{
			memb_idx++;
			if(memb_idx == 28) memb_idx = 0;
		}
		else
		{
			flag1 = 0;
		}
	
	}
}


/*-------------------------------------
	name: FilmStrip
	func: 幻灯片界面运行函数
--------------------------------------*/
void FilmStrip(void)
{	
	u8 part = 0; //指示在哪个部分，0表示不进入幻灯片
	u8 img_idx=0; //指示当前在显示第几张照片
	u8 pic_num = 0; //临时图片数量
	u32 i=1000000;
	u32 st_sec_idx = 3000;
	u8 flag_in = 0;
	u8 flag2 = 0;

	LeaveHP();
	ReturnSHP();

	while(SysState == 3)
	{	
		TP_Prepare();
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
		{	
			if(Touch_Inside_Box(&tp_dev,Back2Home))
			{
				SysState = 0;
				LeaveSHP();
				ReturnHP();
				break;
			}
			else if(Touch_Inside_Box(&tp_dev,Devlp))
			{
				part = 1;
			}
			else if(Touch_Inside_Box(&tp_dev,Prctc))
			{
				part = 2;
			}
			else if(Touch_Inside_Box(&tp_dev,Entrt))
			{
				part = 3;
			}
		}

		if(part)
		{	
			switch(part)
			{
				case 1: {pic_num = part1_num; st_sec_idx = 3000; break;}
				case 2: {pic_num = part2_num; st_sec_idx = 12000; break;}
				case 3: {pic_num = part3_num; st_sec_idx = 21000; break;}
				default:break;
			}

			flag_in = 1;
			part = 0;
			img_idx = 0;
			LeaveSHP();

			while(flag_in)
			{
				LCD_Show_SD_Full_Img(st_sec_idx + 300*img_idx);
				Draw_Box(Back2Home,DARKBLUE);
				Show_Str(9,7, WHITE, DARKBLUE, "返回",16,0);

				i = 1000000;
				while(i--)
				{	
					TP_Prepare();
					tp_dev.scan(0); 
					if(tp_dev.sta&TP_PRES_DOWN)			//触摸屏被按下
					{	
						if(Touch_Inside_Box(&tp_dev,Back2Home))
						{
							flag_in = 0;
							ReturnSHP();
							break;
						}
						else if((tp_dev.x < 160)&&(tp_dev.x > 0))
						{	
							flag2 = 1;
							if(img_idx == 0) img_idx = pic_num - 1;
							else img_idx--;
							break;
						}
						else if((tp_dev.x >= 160)&&(tp_dev.x < 320))
						{
							flag2 = 1;
							if(img_idx == pic_num - 1) img_idx = 0;
							else img_idx++;
							break;
						}
					}
				}

				if(!flag2)
				{
					img_idx++;
					if(img_idx == pic_num) img_idx = 0;
				}
				else
				{
					flag2 = 0;
				}
			}
		}
	}	
}


/*-------------------------------------
	name: HandWrite
	func: 画板界面运行函数
--------------------------------------*/
void HandWrite(void)
{	
	u8 Tools = 0; //0:隐藏工具栏 1:显示工具栏
	u16 bgd_color=BLACK; //背景颜色
	u16 pen_color=WHITE; //彩笔颜色
	u16 tool_color=GRAY; //工具颜色
	u16 i;
	// u8 is_clear=0; //清除标志
	u8 m=0,n=0; //当前的背景颜色和彩笔颜色序号

	LeaveHP();	

	LCD_Clear(bgd_color);
	POINT_COLOR = tool_color;
	Fill_Triangel(5,5,30,20,5,35);

	TP_Prepare();
	POINT_COLOR = BLUE;
	while(SysState == 4)
	{
		tp_dev.scan(0); 
		if(tp_dev.sta&TP_PRES_DOWN)
		{
			switch(Tools)
			{
				case 0: //工具栏未展开状态
				{
					if(Touch_Inside_Box(&tp_dev,ShowTools))	//展开工具栏
					{	
						Tools = 1;
						POINT_COLOR = bgd_color;
						Fill_Triangel(5,5,30,20,5,35);
						POINT_COLOR = tool_color;
						for(i=0;i<100;i++)
						{	
							LCD_DrawLine(i,0,i,239);
						}
						Draw_Box(LeaveHW,DARKBLUE);
						Draw_Box(Clear,DARKBLUE);
						Draw_Box(PColor,pen_color);
						Draw_Box(BColor,bgd_color);
						Show_Str(34, 28, WHITE, DARKBLUE, "返回",16,0);
						Show_Str(34, 84, WHITE, DARKBLUE, "清除",16,0);
						// is_clear = 0;
					}
					else //画图
					{	
						POINT_COLOR = pen_color;
						LCD_DrawPoint(tp_dev.x,tp_dev.y);
					}
					
				}break;
				case 1: //工具栏展开状态
				{
					if(Touch_Inside_Box(&tp_dev,LeaveHW)) //返回主界面
					{
						SysState = 0;
						ReturnHP();
					}
					else if(Touch_Inside_Box(&tp_dev,Clear)) //清屏
					{
						LCD_Fill(100,0,319,239,bgd_color);
						// is_clear = 1;
					}
					else if(Touch_Inside_Box(&tp_dev,PColor)) //切换画笔颜色
					{	
						n++;
						if(n>12) n=0;
						pen_color = PenColorFml[n];
						Draw_Box(PColor,pen_color);
						delay_ms(200);
					}
					else if(Touch_Inside_Box(&tp_dev,BColor)) //切换背景颜色
					{
						m++;
						if(m>1) m=0;
						bgd_color = BgdColorFml[m];
						Draw_Box(BColor,bgd_color);
						LCD_Fill(100,0,319,239,bgd_color);
						// is_clear = 1;
						delay_ms(200);
					}
					else //点击其他地方，隐藏工具栏
					{	
						Tools = 0;
						LCD_Fill(0,0,99,239,tool_color);
						POINT_COLOR = bgd_color;
						for(i=100;i>0;i--)
						{	
							LCD_DrawLine(i-1,0,i-1,239);
						}
						POINT_COLOR = tool_color;
						Fill_Triangel(5,5,30,20,5,35);
					}
				}break;

				default:break;
			}
		}
	}
}


/*-------------------------------------
	name: Calibration
	func: 校准界面运行函数
--------------------------------------*/
void Calibration(void)
{	
	LeaveHP();
	TP_Adjust();  //屏幕校准 
	TP_Save_Adjdata();	 		
	TP_Get_Adjdata();
	SysState = 0;
}


/*-------------------------------------
	name: LeaveHP
	func: 离开主界面动画运行函数
--------------------------------------*/
void LeaveHP(void)
{	
	u8 i;

	Draw_Box(Go2ClassIntr,RED);
	Draw_Box(Go2MembrIntr,YELLOW);
	Draw_Box(Go2FilmStrip,GREEN);
	Draw_Box(Go2HandWrite,BLUE);
	Draw_Box(Go2Calbrtion,BLACK);

	for(i=0;i<106;i++)
	{	
		LCD_Fill(175,105-i,260,105-i,BLACK);
		LCD_Fill(60,105-i,145,105-i,BLACK);
		LCD_Fill(175,135+i,260,135+i,BLACK);
		LCD_Fill(60,135+i,145,135+i,BLACK);

		if(i<=50)
		{
			LCD_Fill(175,49-i,260,49-i,YELLOW);
			LCD_Fill(60,49-i,145,49-i,RED);
			LCD_Fill(175,191+i,260,191+i,BLUE);
			LCD_Fill(60,191+i,145,191+i,GREEN);
		}
		delay_us(1500);
	}
}


/*-------------------------------------
	name: ReturnHP
	func: 返回主界面动画运行函数
--------------------------------------*/
void ReturnHP(void)
{	
	u8 i;

	LCD_Clear(BLACK);

	for(i=105;i>0;i--)
	{	
		LCD_Fill(175,105-i,260,105-i,YELLOW);
		LCD_Fill(60,105-i,145,105-i,RED);
		LCD_Fill(175,135+i,260,135+i,BLUE);
		LCD_Fill(60,135+i,145,135+i,GREEN);

		if(i<=50)
		{
			LCD_Fill(175,49-i,260,49-i,BLACK);
			LCD_Fill(60,49-i,145,49-i,BLACK);
			LCD_Fill(175,191+i,260,191+i,BLACK);
			LCD_Fill(60,191+i,145,191+i,BLACK);
		}
		delay_us(1500);
	}
}


/*-------------------------------------
	name: LeaveSHP
	func: 进入幻灯片主界面动画运行函数
--------------------------------------*/
void LeaveSHP(void)
{	
	u16 i;

	Draw_Box(Devlp,LRED);
	Draw_Box(Prctc,GREEN);
	Draw_Box(Entrt,GBLUE);
	Draw_Box(Back2Home,BLACK);

	for(i=0;i<370;i++)
	{	
		if(i<230)
		{
			LCD_Fill(90+i,40,90+i,80,BLACK);
			if(i<90) LCD_Fill(230+i,40,230+i,80,LRED);
		}
		if((i<230+70)&&(i>=70))
		{
			LCD_Fill(90+i-70,100,90+i-70,140,BLACK);
			if(i<90+70) LCD_Fill(230+i-70,100,230+i-70,140,GREEN);
		}
		if((i<230+140)&&(i>=140))
		{
			LCD_Fill(90+i-140,160,90+i-140,200,BLACK);
			if(i<90+140) LCD_Fill(230+i-140,160,230+i-140,200,GBLUE);
		}
		delay_ms(1);
	}
	LCD_Clear(BLACK);
}


/*-------------------------------------
	name: ReturnSHP
	func: 进入幻灯片主界面动画运行函数
--------------------------------------*/
void ReturnSHP(void)
{	
	u16 i;

	LCD_Clear(BLACK);
	for(i=0;i<370;i++)
	{	
		if(i<230)
		{
			LCD_Fill(319-i,40,319-i,80,LRED);
			if(i>=140) LCD_Fill(459-i,40,459-i,80,BLACK);
		}
		if((i>70)&&(i<70+230))
		{
			LCD_Fill(319+70-i,100,319+70-i,140,GREEN);
			if(i>=140+70) LCD_Fill(459+70-i,100,459+70-i,140,BLACK);
		}
		if((i>140)&&(i<140+230))
		{
			LCD_Fill(319+140-i,160,319+140-i,200,GBLUE);
			if(i>=140+140) LCD_Fill(459+140-i,160,459+140-i,200,BLACK);
		}
		delay_ms(1);
	}
	Show_Str(112,52, BLACK, LRED, "成长从不设限",16,0);
	Show_Str(112,112, BLACK, GREEN, "服务没有终点",16,0);
	Show_Str(112,172, BLACK, GBLUE, "青春洋溢笑脸",16,0);
	Draw_Box(Back2Home,DARKBLUE);
	Show_Str(9,7, WHITE, DARKBLUE, "返回",16,0);
}


/*-------------------------------------
	name: DrawHomePage
	func: 画主界面
--------------------------------------*/
void DrawHomePage(void)
{	
	// LCD_Clear(BLACK);
	Draw_Box(Go2ClassIntr,RED);
	Show_Str(70, 68, BLACK, RED, "班级介绍",16,0);
	Draw_Box(Go2MembrIntr,YELLOW);
	Show_Str(185, 68, BLACK, YELLOW, "成员介绍",16,0);
	Draw_Box(Go2FilmStrip,GREEN);
	Show_Str(70, 153, BLACK, GREEN, "风采展示",16,0);
	Draw_Box(Go2HandWrite,BLUE);
	Show_Str(185, 153, BLACK, BLUE, "趣味画板",16,0);
	Draw_Box(Go2Calbrtion,GRAY);
	Show_Str(279, 7, BLACK, GRAY, "校准",16,0);
}


/*-------------------------------------
	name: DrawClassIntr
	func: 画班级介绍界面
--------------------------------------*/
void DrawClassIntr(void)
{
	LCD_Show_SD_Full_Img(100);
	Draw_Box(Back2Home,DARKBLUE);
	Show_Str(9,7, WHITE, DARKBLUE, "返回",16,0);
}


/*-------------------------------------
	name: LCD_Show_SD_Full_Img
	func: 从SD读一张全图显示
--------------------------------------*/
void LCD_Show_SD_Full_Img(u32 StartSector)
{	
	u16 idx_sector;
	u16 idx_buf;

	LCD_SetWindows(0, 0,319,239);
	SD_Prepare();

	for(idx_sector = 0; idx_sector<300; idx_sector++)
	{	
		SD_ReadDisk(SD_Out_Buf, StartSector+idx_sector, 1);
		for(idx_buf = 0; idx_buf<256; idx_buf++)
			LCD_WR_DATA(((u16)(*(SD_Out_Buf + 2*idx_buf))<<8) | ((u16)(*(SD_Out_Buf + 2*idx_buf + 1))));
	}
}


/*-------------------------------------
	name: LCD_Show_SD_Small_Img
	func: 从SD读一张小图显示(128*200)
--------------------------------------*/
void LCD_Show_SD_Small_Img(u32 StartSector)
{	
	u16 idx_sector;
	u16 idx_buf;

	LCD_SetWindows(20, 20,20+127,20+199);
	SD_Prepare();

	for(idx_sector = 0; idx_sector<100; idx_sector++)
	{	
		SD_ReadDisk(SD_Out_Buf, StartSector+idx_sector, 1);
		for(idx_buf = 0; idx_buf<256; idx_buf++)
			LCD_WR_DATA(((u16)(*(SD_Out_Buf + 2*idx_buf))<<8) | ((u16)(*(SD_Out_Buf + 2*idx_buf + 1))));
	}
}


/*----------------------------------------------------
	name: Touch_Inside_Box
	func: 判断按下的键是否在方框内
	parameter: 
		p        触屏器件结构体指针
		boxhd    存放方框位置参数的数组指针
	retvalue: 0 不在方框内, 1 在方框内
----------------------------------------------------*/
u8 Touch_Inside_Box(_m_tp_dev* p,u16* boxhd)
{
	if(p->x>(*boxhd)&&p->x<(*(boxhd + 2)))
	{
		if(p->y>(*(boxhd+1))&&p->y<(*(boxhd + 3)))
		{
			return 1;
		}
	}
	return 0;
}


/*----------------------------------------------------
	name: Draw_Box
	func: 画按钮
	parameter: 
		color    填充颜色
		boxhd    存放方框位置参数的数组指针
----------------------------------------------------*/
void Draw_Box(u16* boxhd,u16 color)
{
	LCD_Fill(*boxhd,*(boxhd + 1),*(boxhd + 2),*(boxhd + 3),color);
}


/*----------------------------------------------------
	name: ShowSquare
	func: 画正方形图案
	parameter: 
		side_len    正方形边长
		p           图案模指针
		fcolor      图案颜色
		bcolor      背景颜色
		sx,sy       起始坐标
----------------------------------------------------*/
void ShowSquare(u8* p,u16 side_len,u16 fcolor,u16 bcolor,u16 sx,u16 sy)
{	
	u16 data_len;
	u16 i,j;
	u8 buf;

	LCD_SetWindows(sx,sy,sx + side_len -1,sy + side_len -1);
	data_len = side_len * side_len;
	for(i=0; i<(data_len/8); i++)
	{	
		buf = *(p + i);
		for(j=0; j<8; j++)
		{
			if(buf & 0x80) LCD_WR_DATA(fcolor);
			else LCD_WR_DATA(bcolor);
			buf = buf << 1;
		}
	}
}


/*-------------------------------------
	name: Appr
	func: 班级介绍文字栏出现函数
--------------------------------------*/
void Appr(void)
{	
	u16 i;

	POINT_COLOR = YELLOW;
	Fill_Triangel(0,24,0,24+48,28,24);
	for(i=28; i<208; i++)
	{
		LCD_DrawLine(i,24,i-28,24+48);
		delay_us(400);
	}

	POINT_COLOR = GREEN;
	Fill_Triangel(0,24+72,0,24+48+72,28,24+72);
	for(i=28; i<166; i++)
	{
		LCD_DrawLine(i,24+72,i-28,24+48+72);
		delay_us(400);
	}

	POINT_COLOR = GBLUE;
	Fill_Triangel(0,24+144,0,24+48+144,28,24+144);
	for(i=28; i<124; i++)
	{
		LCD_DrawLine(i,24+144,i-28,24+48+144);
		delay_us(400);
	}
}


/*-------------------------------------
	name: Disappr
	func: 班级介绍文字栏消失函数
--------------------------------------*/
void Disappr(void)
{	
	u16 i;

	POINT_COLOR = BLACK;
	LCD_Fill(0,24+144,180-84-1,24+48+144,GBLUE);
	for(i=123; i>=28; i--)
	{
		LCD_DrawLine(i,24+144,i-28,24+48+144);
		delay_us(400);
	}
	Fill_Triangel(0,24+144,0,24+48+144,28,24+144);

	LCD_Fill(0,24+72,180-42-1,24+48+72,GREEN);
	for(i=165; i>=28; i--)
	{
		LCD_DrawLine(i,24+72,i-28,24+48+72);
		delay_us(400);
	}
	Fill_Triangel(0,24+72,0,24+48+72,28,24+72);

	LCD_Fill(0,24,179,24+48,YELLOW);
	for(i=207; i>=28; i--)
	{
		LCD_DrawLine(i,24,i-28,24+48);
		delay_us(400);
	}
	Fill_Triangel(0,24,0,24+48,28,24);
}


/*----------------------------------------------------
	name: Show_Memb_Info
	func: 显示班级成员个人信息
	parameter: 
		idx    索引
----------------------------------------------------*/
void Show_Memb_Info(u8 idx)
{
	//!涉及大量个人信息，已清空
}
